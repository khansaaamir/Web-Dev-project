<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CRUD App</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
<h3 class="text-center mb-3">CRUD App with JQuery and REST API</h3>

<div class="card mb-4">
<div class="card-body">
<form id="myform">
<input type="hidden" id="pid">
<div class="mb-2">
<label>Title</label>
<input type="text" id="ptitle" class="form-control" required>
</div>
<div class="mb-2">
<label>Body</label>
<textarea id="pbody" class="form-control" required></textarea>
</div>
<button type="submit" class="btn btn-primary" id="savebtn">Add Post</button>
<button type="button" class="btn btn-secondary d-none" id="cancelbtn">Cancel</button>
</form>
</div>
</div>

<div class="card">
<div class="card-body">
<h5>All Posts</h5>
<div id="loading" class="text-center my-2" style="display:none;">Loading...</div>
<table class="table table-bordered">
<thead class="table-dark">
<tr>
<th>ID</th><th>Title</th><th>Body</th><th>Action</th>
</tr>
</thead>
<tbody id="postlist"></tbody>
</table>
</div>
</div>
</div>

<script>
$(function(){
let api="https://jsonplaceholder.typicode.com/posts"

function showload(x){ if(x)$("#loading").show(); else $("#loading").hide(); }

function getPosts(){
showload(true)
$.get(api,function(data){
showload(false)
let txt=""
for(let i=0;i<10;i++){
txt+="<tr id='r"+data[i].id+"'><td>"+data[i].id+"</td><td>"+data[i].title+"</td><td>"+data[i].body+"</td><td><button class='btn btn-sm btn-warning edit' data-id='"+data[i].id+"'>Edit</button> <button class='btn btn-sm btn-danger del' data-id='"+data[i].id+"'>Delete</button></td></tr>"
}
$("#postlist").html(txt)
}).fail(function(){alert("error while loading")})
}
getPosts()

$("#myform").submit(function(e){
e.preventDefault()
let id=$("#pid").val()
let d={title:$("#ptitle").val(),body:$("#pbody").val(),userId:1}
if(id){
$.ajax({
url:api+"/"+id,method:"PUT",data:d,
success:function(u){
$("#r"+id+" td:nth-child(2)").text(u.title)
$("#r"+id+" td:nth-child(3)").text(u.body)
alert("updated!")
$("#myform")[0].reset()
$("#pid").val("")
$("#savebtn").text("Add Post")
$("#cancelbtn").addClass("d-none")
},
error:function(){alert("error updating")}
})
}else{
$.post(api,d,function(n){
let row="<tr id='r"+n.id+"'><td>"+n.id+"</td><td>"+n.title+"</td><td>"+n.body+"</td><td><button class='btn btn-sm btn-warning edit' data-id='"+n.id+"'>Edit</button> <button class='btn btn-sm btn-danger del' data-id='"+n.id+"'>Delete</button></td></tr>"
$("#postlist").prepend(row)
alert("added!")
$("#myform")[0].reset()
}).fail(function(){alert("error adding")})
}
})

$(document).on("click",".edit",function(){
let id=$(this).data("id")
let r=$("#r"+id)
$("#pid").val(id)
$("#ptitle").val(r.find("td:nth-child(2)").text())
$("#pbody").val(r.find("td:nth-child(3)").text())
$("#savebtn").text("Update")
$("#cancelbtn").removeClass("d-none")
})

$("#cancelbtn").click(function(){
$("#myform")[0].reset()
$("#pid").val("")
$("#savebtn").text("Add Post")
$("#cancelbtn").addClass("d-none")
})

$(document).on("click",".del",function(){
if(confirm("delete this?")){
let id=$(this).data("id")
$.ajax({
url:api+"/"+id,method:"DELETE",
success:function(){
$("#r"+id).remove()
alert("deleted!")
},
error:function(){alert("error deleting")}
})
}
})
})
</script>

</body>
</html>
